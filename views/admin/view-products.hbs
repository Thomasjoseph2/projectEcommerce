<style>


  body {
    background-image: url('/img/banner/banner-bg.jpg');
  }
</style>
<section style="margin-top: 6rem;" class="section-margin ">
  <div class="container mt-4">
    <div class="row mt-5">
      <a href="/admin/add-product" class="btn btn-success mr-auto mt-5"
        style="background-color: #FFAD01;color:aliceblue;">Add Products</a>
    </div>
    <div class="mt-5">
      <table class="table mt-1" id="myTable">
        <thead>
          <tr>
            <th scope="col">Title</th>
            <th scope="col">Category</th>
            <th scope="col">Description</th>
            <th scope="col">Price</th>
            <th>Image</th>
            <th scope="col">Options</th>
          </tr>
        </thead>
    <tbody>
  {{#each products}}
  <tr>
    <td>{{this.productName}}</td>
    <td>{{this.categoryName}}</td>
    <td>{{this.productDescription}}</td>
    <td>{{this.productPrice}}</td>
    <td><img style="width:50px;height:50px" src="/product-images/{{this._id}}.jpg" alt=""></td>
    <td>
        <button style="background-color: #fe7200; color: white;" type="button" class="btn add-offer"
                data-product-id="{{this._id}}" data-product-name="{{this.productName}}"
                data-toggle="modal" data-target="#offerModal{{this._id}}">Add Offer</button>

      <a href="/admin/edit-product/{{this._id}}" class="btn " style="background-color: #FFAD01;color:aliceblue;">Edit</a>
      <a href="/admin/delete-product?id={{this._id}}" class="btn btn-danger"
        onclick="return confirm('Are you sure you want to delete {{this.name}}?')">Delete</a>
         
    </td>
  </tr>
         <div class="modal fade" id="offerModal{{this._id}}" tabindex="-1" role="dialog" aria-labelledby="offerModalLabel"
            aria-hidden="true">

            <div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="offerModalLabel">Add Offer</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <form action="/admin/add-product-offer" method="POST" id="offerForm">
        <div class="form-group">
          <label for="category-offer">Product Offer:</label>
          <input type="number" class="form-control" id="category-offer" name="productOffer" required min="0" max="100">
          <input type="hidden" class="form-control" id="{{this._id}}" name="productId" value="{{this._id}}">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </div>
</div>

            </div>
  {{/each}}
</tbody>

      </table>
    </div>
  </div>
</section>
<script>
  $(document).ready(function () {
    $('#myTable').DataTable();
  });

  $(document).ready(function () {
    $('#offerForm').submit(function (event) {
      event.preventDefault();

      var offerInput = $('#category-offer');
      var offerValue = parseInt(offerInput.val());

      if (offerValue > 100) {
        // Show error message
        offerInput.addClass('is-invalid');
        offerInput.siblings('.invalid-feedback').text('Offer percentage cannot be greater than 100.');
      } else {
        // Perform AJAX request to add the offer
        $.ajax({
          url: '/admin/add-product-offer',
          method: 'POST',
          data: $('#offerForm').serialize(),
          success: function (response) {
            // Reset the form fields
            $('#offerForm')[0].reset();
            location.reload()

            // If the offer is successfully added, update the category table
            $('#categoryTableContainer').load('/admin/category #category-data-table');
          },
          error: function (error) {
            console.log(error);
            location.reload(); // Refresh the page to restore the original state
          }
        });
      }
    });
  });
</script>